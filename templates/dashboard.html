{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}

<h2>Inventory Dashboard</h2>

<form method="POST" class="fade-in">
  <label for="name">Item Name</label>
  <input type="text" name="name" id="name" required>

  <label for="quantity">Quantity</label>
  <input type="number" name="quantity" id="quantity" required>

  <label for="par">Par Level</label>
  <input type="number" name="par" id="par" required>

  <label for="category">Category</label>
  <select name="category" id="category" required>
    <option value="" disabled selected>Select category</option>
    <option value="Frozen">Frozen</option>
    <option value="Asian">Asian</option>
    <option value="Dairy">Dairy</option>
    <option value="Produce">Produce</option>
    <option value="Bakery">Bakery</option>
    <option value="Meat">Meat</option>
    <option value="Pasta & Rice">Pasta & Rice</option>
    <option value="Grains & Bread">Grains & Bread</option>
    <option value="Sauces">Sauces</option>
    <option value="Indian">Indian</option>
    <option value="American">American</option>
    <option value="Foreign">Foreign</option>
    <option value="Canned Goods">Canned Goods</option>
    <option value="Snacks">Snacks</option>
    <option value="Drinks">Drinks</option>
  </select>

  <label for="expiration">Expiration Date</label>
  <input type="date" name="expiration" id="expiration">

  <button type="submit">Add Item</button>
</form>

{% if items %}
  <h3>Your Inventory</h3>
  {% for item in items %}
    <div class="item fade-in">
      <div>
        <strong>{{ item.name }}</strong> | Qty: {{ item.quantity }} / Par: {{ item.par }}<br>
        {% if item.category %}<small>Category: {{ item.category }}</small><br>{% endif %}
        {% if item.expiration %}
          {% set delta = (item.expiration - now).days %}
          <small>Expires in: {{ delta }} day{{ 's' if delta != 1 else '' }}</small><br>
        {% endif %}
      </div>
      <div>
        <a href="javascript:void(0);"
           onclick="openEditModal('{{ item._id }}', '{{ item.name }}', '{{ item.quantity }}', '{{ item.par }}', '{{ item.category }}', '{{ item.expiration|default('', true) }}')">‚úèÔ∏è</a>
        <a href="/delete/{{ item._id }}">üóëÔ∏è</a>
      </div>
    </div>
  {% endfor %}
{% endif %}

{% if shopping %}
  <h3>üõí Shopping List</h3>
  <ul>
    {% for item in shopping %}
      <li>{{ item.name }} (Need {{ item.par - item.quantity }})</li>
    {% endfor %}
  </ul>
{% endif %}

<div class="clear-btn-wrapper">
  <a href="/clear-inventory" class="btn">Clear Inventory</a>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" onclick="document.getElementById('editModal').style.display='none'">&times;</span>
    <form method="POST" id="editForm">
      <input type="hidden" name="edit_id" id="edit_id">
      <label for="edit_name">Item Name</label>
      <input type="text" name="name" id="edit_name" required>

      <label for="edit_quantity">Quantity</label>
      <input type="number" name="quantity" id="edit_quantity" required>

      <label for="edit_par">Par Level</label>
      <input type="number" name="par" id="edit_par" required>

      <label for="edit_category">Category</label>
      <input type="text" name="category" id="edit_category">

      <label for="edit_expiration">Expiration</label>
      <input type="date" name="expiration" id="edit_expiration">

      <button type="submit">Update</button>
    </form>
  </div>
</div>

<script>
function openEditModal(id, name, quantity, par, category, expiration) {
  document.getElementById('edit_id').value = id;
  document.getElementById('edit_name').value = name;
  document.getElementById('edit_quantity').value = quantity;
  document.getElementById('edit_par').value = par;
  document.getElementById('edit_category').value = category;

  if (expiration && expiration !== 'None') {
    document.getElementById('edit_expiration').value = expiration.split('T')[0];
  } else {
    document.getElementById('edit_expiration').value = '';
  }

  document.getElementById('editModal').style.display = 'block';
}
</script>

{% endblock %}
